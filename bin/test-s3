#!/usr/bin/env bash

set -euo pipefail

# start our_temp_dir: v1
our_temp_dir=$(mktemp -d 2>/dev/null || mktemp -d -t 'our_temp_dir')
function cleanup_temp_dir() { rm -rf "$our_temp_dir" ; } && trap "cleanup_temp_dir" EXIT
# end our_temp_dir

if [[ "${1-}" == "--local" ]]; then
    codedown shell < README.md | grep -v  github.com/pesterhazy/moth/releases > "$our_temp_dir/transcript"
    cp bin/mothg "$our_temp_dir/moth"
else
    codedown shell < docs/s3.md > "$our_temp_dir/transcript"
fi

set -x

cd "$our_temp_dir"

export AWS_ACCESS_KEY_ID="1234"
export AWS_SECRET_ACCESS_KEY="1234"
export MOTH_S3_ENDPOINT="http://localhost:4568"

source transcript
